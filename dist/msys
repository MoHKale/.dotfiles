- defaults:
    bots:
      config: 'config.yml'
      unsafe: true

- bots:
    - ../programs/chocolatey

# setup msys, the unix like environment for windows
- packages:
    chocolatey:
      - msys2

- shell:
    - description: setting msys home directory
      quiet: true
      command: |-
        conf_file="c:/tools/msys64/etc/nsswitch.conf"
        if ! [ -f "$conf_file" ]; then
          echo "failed to set msys user home directory, conf file doesn't exist" >&2
          exit 1
        fi

        sed -i -e 's/db_home: cygwin desc/db_home: windows/' "$conf_file"

- shell:
    - description: allowing windows PATH inheritance
      quiet: true
      command: |-
        conf_file="c:/tools/msys64/msys2_shell.cmd"
        if ! [ -f "$conf_file" ]; then
          echo "failed to set PATH inheritance, conf file doesn't exist" >&2
          exit 1
        fi

        sed -i -e 's/rem \(set MSYS2_PATH_TYPE=inherit\)/\1/' "$conf_file"

- packages:
    msys:
      - base-devel
      - make
      - gcc
      - mingw-w64-x86_64-gcc

- bots:
    - ../programs/git

- shell:
    - description: installing winpty
      quiet: true
      command: |-
        [ -e "c:/tools/msys64/usr/local/bin/winpty.exe" ] && exit 0

        c:/tools/msys64/usr/bin/env bash << "EOF"
        cd $(mktemp -d)
        git clone https://github.com/rprichard/winpty winpty
        cd winpty

        export PATH=/mingw64/bin/:$PATH
        ./configure
        make install
        EOF

- bots:
    - ../programs/wsl
    - ../programs/cmder
